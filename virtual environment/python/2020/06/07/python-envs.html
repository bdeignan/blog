<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tools for creating clean Python environments | Brian Deignan</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Tools for creating clean Python environments" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="What I’ve leared after trying Conda, Pipenv and Poetry" />
<meta property="og:description" content="What I’ve leared after trying Conda, Pipenv and Poetry" />
<link rel="canonical" href="https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html" />
<meta property="og:url" content="https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html" />
<meta property="og:site_name" content="Brian Deignan" />
<meta property="og:image" content="https://bdeignan.github.io/blog/images/dirty-env.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-07T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"What I’ve leared after trying Conda, Pipenv and Poetry","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html"},"url":"https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html","headline":"Tools for creating clean Python environments","dateModified":"2020-06-07T00:00:00-05:00","datePublished":"2020-06-07T00:00:00-05:00","image":"https://bdeignan.github.io/blog/images/dirty-env.jpg","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://bdeignan.github.io/blog/feed.xml" title="Brian Deignan" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tools for creating clean Python environments | Brian Deignan</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Tools for creating clean Python environments" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="What I’ve leared after trying Conda, Pipenv and Poetry" />
<meta property="og:description" content="What I’ve leared after trying Conda, Pipenv and Poetry" />
<link rel="canonical" href="https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html" />
<meta property="og:url" content="https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html" />
<meta property="og:site_name" content="Brian Deignan" />
<meta property="og:image" content="https://bdeignan.github.io/blog/images/dirty-env.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-07T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"What I’ve leared after trying Conda, Pipenv and Poetry","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html"},"url":"https://bdeignan.github.io/blog/virtual%20environment/python/2020/06/07/python-envs.html","headline":"Tools for creating clean Python environments","dateModified":"2020-06-07T00:00:00-05:00","datePublished":"2020-06-07T00:00:00-05:00","image":"https://bdeignan.github.io/blog/images/dirty-env.jpg","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://bdeignan.github.io/blog/feed.xml" title="Brian Deignan" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Brian Deignan</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/_pages/about.html">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Tools for creating clean Python environments</h1><p class="page-description">What I&#39;ve leared after trying Conda, Pipenv and Poetry</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-07T00:00:00-05:00" itemprop="datePublished">
        Jun 7, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      9 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#virtual environment">virtual environment</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img src="/blog/images/dirty-env.jpg" alt="" title="Don't pollute your development environment!" /></p>

<p>When I was starting out as a data scientist using Python – every other day Googling “python development setup for data science” – conda was the most recommended way to get started. Now, I’ve been programming in Python for the past 3+ years and during that time I have actually moved away from using <a href="https://docs.conda.io/projects/conda/en/latest/index.html">conda virtual environments</a> for my projects. On my journey to conda alternatives, I’ve tried virtualenv, pyenv, Pipenv and most recently Poetry. All these tools overlap in some ways and can be confusing to untangle.</p>

<p>I want to offer a brief overview of three ways to manage Python virtual environments and describe what I’ve been using lately myself. I’m always learning and changing my mind. So, if I return to using conda, I’ll create an update post with plenty of penance.</p>

<p>Who may find this post helpful:</p>
<ul>
  <li>Beginner/intermediate Python users who have used virtual environments</li>
  <li>Those who manage their Python projects and environments in a terminal</li>
  <li>Mostly for macOS and Linux users – only brief mention of Windows</li>
  <li>Those who have made a royal mess of their machine’s Python installation before</li>
</ul>

<p><img src="https://imgs.xkcd.com/comics/python_environment.png" alt="" title="Obligatory xkcd comic: https://xkcd.com/1987/" /></p>

<h3 id="python-virtual-environments">Python virtual environments</h3>
<p>It would take way too long to list all of the ways I’ve installed and managed Python versions on local and remote machines. I’ve done everything from downloading a zip on Windows machine to <code class="highlighter-rouge">brew install python</code>.</p>

<p>I’ve read dozens of blog posts and opinions on this subject. I still haven’t found one that is exactly what I was looking for when I started out. That’s what this post is for: if you want to easily start using Python for multiple projects – say, pulled from GitHub – and you know enough that you don’t want to pollute your system-wide Python distribution with tons of <code class="highlighter-rouge">pip install</code> commands.</p>

<p>When I started out using virtual environments, I didn’t really know what they were. Following the conda instructions don’t really elucidate this either. That’s probably my fault for not reading carefully enough. Nevertheless, if you’re like me in the past, then: Python virtual environments are simply directories where Python files are kept. There’s a little more to it than that. I like how <a href="https://towardsdatascience.com/virtual-environments-104c62d48c54">this post</a> explains them in more detail (and lots of cool Doré art).</p>

<p>Now armed with this knowledge, let’s start with a discussion of conda.</p>

<h3 id="conda">Conda</h3>
<p>Some basic usage:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create a new environment</span>
conda create <span class="nt">--name</span> myenv
<span class="c"># activate the environment</span>
conda activate myenv
<span class="c"># install pandas package in environment</span>
conda <span class="nb">install </span>pandas
<span class="c"># see you environments - trust me you'll need this</span>
conda info <span class="nt">--envs</span>
</code></pre></div></div>

<p>Conda has some great features. You can specify the version of Python you’d like to use when creating a new environment. And environments aren’t tied to a directory; you can activate them anywhere.</p>

<p>However, I always faced a few problems using conda:</p>
<ul>
  <li>What do I name the environment?</li>
  <li>What <em>did</em> I name the environment I want to activate? I never remembered and always refer to listing out all of my conda environments.</li>
  <li>Will I use it for another project? Maybe. But almost always I did’t end up reusing environments for another project.</li>
</ul>

<p>When installing packages in your conda environment, another problem may soon become apparent. For example, I use the package <a href="https://pypi.org/project/python-dotenv/">dotenv</a> quite a bit. However, <code class="highlighter-rouge">conda install python-dotenv</code> won’t work. That’s because you need to specify the channel – i.e. package repository – on which it can be found. In this case, it’s on <a href="https://conda-forge.org/">Conda-Forge</a>.</p>

<p>You can find more on channels in <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/channels.html">the documentation</a>. But suffice it to say, conda doesn’t use <a href="https://en.wikipedia.org/wiki/Python_Package_Index">PyPI</a>, the official repository for third-party packages. This is where pip goes to look for packages when you run <code class="highlighter-rouge">pip install pandas</code>.</p>

<p>Another complaint I had with conda comes purely from my personal experience. I could not get it to work across platforms, namely from macOS to Windows. I have colleagues who use Windows. So, when I shared an <code class="highlighter-rouge">environment.yml</code> file with them to recreate my development environment, I was disappointed with how many errors were thrown in the setup process.</p>

<p>I’ve never actually seen anyone use the yaml files to successfully build an environment moved from macOS to Windows with the command: <code class="highlighter-rouge">conda env create -f environment.yml</code>. They always had to manually install packages the that failed. Inevitably, these packages would then have different versions than mine. And just like that, we’re no longer developing in the same environment. This led me to seek out better options.</p>

<h3 id="pipenv">Pipenv</h3>
<p>Some basic usage:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create environment in current directory</span>
pipenv <span class="nb">install</span>
<span class="c"># install pandas in environment</span>
pipenv <span class="nb">install </span>pandas
<span class="c"># run a script using environment</span>
pipenv run python script.py
<span class="c"># activate the environment </span>
pipenv shell
</code></pre></div></div>

<p>Having had no success with sharing conda environments from macOS to Windows, I decided to experiment with a controversial Python packaging tool – <a href="https://pipenv.pypa.io/en/latest/">Pipenv</a>. For a project at work, I was required to move a Python project from my local Macbook to a secure Windows VDI (please don’t ask me about this experience :] ).</p>

<p>Despite all the <a href="https://news.ycombinator.com/item?id=18612590">derision</a> directed at it, I was surprised how easily it worked for me. I created a <code class="highlighter-rouge">requirements.txt</code> for the project that I needed to move. After copying it to the Windows VDI, I just changed into the project directory and ran <code class="highlighter-rouge">pipenv install</code>. And magic! A new environment was created exactly how it was on my local Macbook. I didn’t see any package installation failures. It was so easy that I thought I had stumbled upon some secret Python package management Valhalla. Well, except for all those Pipfile lock errors I kept getting once I needed to install new packages.</p>

<p>The constant lock errors and the slowness of installing are two of the first pain points I noticed with Pipenv.</p>

<p>Here’s an example of locking error installing <a href="https://pypi.org/project/black/">black</a> in a Docker container:
<img src="/blog/images/piplock-fail.png" alt="" /></p>

<p>I saved you an additional 10 lines of error messages in this example, but you get the point. Unfortuanely, the story of Pipenv doesn’t end with a “happily ever after.” Pipenv is controversial for good reasons. I won’t drag it all out here since there is already a <a href="https://chriswarrick.com/blog/2018/07/17/pipenv-promises-a-lot-delivers-very-little/">comprehensive post</a> that does this.</p>

<p>While Pipenv felt like magic at first, it’s kind of slow, not many people advocate using it in the Python community from what I can tell and I kept seeing those locking errors. Oh, those locking errors. Moreover, as data scientists, machine learning engineers, statisticians – or whatever you call yourself – start using Python more and more, it’s important to learn more about the tools non-data science Python programmers use for packaging, deployment, and managing dependencies. That’s what motivated me to check out the next tool, Poetry.</p>

<h3 id="poetry">Poetry</h3>
<p>Some basic usage:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create a new project and directory called "project"</span>
poetry new project
<span class="nb">cd </span>project
<span class="c"># install pandas</span>
poetry add pandas
<span class="c"># run a python command in environment</span>
poetry run python <span class="nt">-V</span>
<span class="c"># activate environment</span>
poetry shell
</code></pre></div></div>

<p>Recently, I learned about a new kid on the block in packaging and dependency management: <a href="https://python-poetry.org/">Poetry</a>. It’s a lot like Pipenv but appears to work more smoothly and makes it easy for building packages – which I find myself doing more and more. These days, my Python projects involve writing some source code scripts for a project and importing them like a normal Python module into a Jupyter notebook and using it in data analysis and modeling.</p>

<p>Poetry automatically sets up a standard Python package repo for you with the <code class="highlighter-rouge">poetry new &lt;project-name&gt;</code> command. It even creates a directory for tests, which you should absolutely be doing for any Python project that spans a substantial amount of lines.</p>

<p>Poetry has some other cool features that make it <a href="https://python-poetry.org/docs/libraries/">easier to publish your Python library</a> to PyPI. But that’s beyond the scope of this post.</p>

<div class="Toast">
   <span class="Toast-icon"><svg class="octicon octicon-info" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 01-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 01-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>
   <span class="Toast-content">In my Ubuntu docker container, I had to run "apt-get install python3-venv" to get Poetry to work. This error is raised right away and tells you how to fix it, so it was easy to address.</span>
</div>

<p>Poetry is what I’ll be using for now – as a data scientist using Python. That is, until I have to install Tensorflow.</p>

<h3 id="faq">FAQ</h3>
<p>What if you want a tool that is not tied to a single directory, or the system’s version of Python, or even Python at all?</p>
<ul>
  <li>Removing the single directory constraint:
    <ul>
      <li>One very relatable gripe of the <a href="https://chriswarrick.com/blog/2018/07/17/pipenv-promises-a-lot-delivers-very-little/">post critiquing Pipenv</a> is: Pipenv and Poetry virtual environments are not easily activated outside of their project’s directory – One way around this is using the “standard tools” Pip and <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>.</li>
      <li>Also, conda allows you to activate an environment anywhere.</li>
    </ul>
  </li>
  <li>Using multiple versions of Python:
    <ul>
      <li>Poetry <a href="https://python-poetry.org/docs/managing-environments/">suggests using pyenv</a> before creating a new environment</li>
      <li>Conda does this out-of-the-box</li>
    </ul>
  </li>
  <li>On not using Python:
    <ul>
      <li>Ok, this is firmly beyond scope of this post now. But in the case that your data science project doesn’t use just Python, then consider conda or whatever popular package manager there is for the programming language.</li>
    </ul>
  </li>
</ul>

<h3 id="conclusion">Conclusion</h3>
<p>I’m beginning to move more towards using Docker, which for the most part, makes virtual environments pointless. That would be a bad way to end this post – to talk about everything but Docker and then end saying that I use Docker. So, I’ll shelve the Docker discussion for another day.</p>

<p>Where is my current thinking on managing Python environments? Pipenv works across platforms easily. I’ve seen this firsthand. But with the long installation times and constant locking issues, I don’t see a reason to use it over Poetry.</p>

<p>For me, conda isn’t as useful these days. I don’t currently work on projects with crazy C++ dependencies, or projects that use both R and Python. I haven’t had good experience with conda working across platforms, which is important when you have Windows collaborators or when you want to move a local project to Docker (Oh! I forgot, we’re not talking about Docker). But I might return to conda if it’s the easiest way to install some fancy library or framework I need, like Tensorflow.</p>

<p>And that’s the main takeaway. Find the best tool for your job. That’s the special sauce data scientists bring to their analysis and modeling. The same goes for creating tidy, reproducible development environments for your projects.</p>

<h3 id="bonus-docker-stuff">Bonus: Docker stuff</h3>
<p>Here’s the Dockerfile I used for the Ubuntu container where I tested Pipenv and Poetry.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM ubuntu:latest

RUN apt-get update \
  &amp;&amp; apt-get install -y python3-pip python3-dev \
  &amp;&amp; cd /usr/local/bin \
  &amp;&amp; ln -s /usr/bin/python3 python \
  &amp;&amp; pip3 install --upgrade pip

ENTRYPOINT ["/bin/bash"]
</code></pre></div></div>

<p>In the same directory as this Dockerfile, build the image: <code class="highlighter-rouge">docker build -t test-python-env .</code>.</p>

<p>And then run a container: <code class="highlighter-rouge">docker run -it -p 8888:8888 --name brian-test test-python-env</code>. In this case, I wanted to test Jupyter notebooks so I binded the host and container 8888 ports.</p>

  </div><a class="u-url" href="/blog/virtual%20environment/python/2020/06/07/python-envs.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A data science blog built with fastpages. It&#39;s an awesome tool and I encourage you to check it out.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/bdeignan" title="bdeignan"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/BrianDeignan" title="BrianDeignan"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
